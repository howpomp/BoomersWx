<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boomers Boca Raton - Weather Operations Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #e63946;
            --primary-dark: #d62828;
            --secondary: #457b9d;
            --accent: #f4a261;
            --warning: #f77f00;
            --danger: #d62828;
            --success: #06a77d;
            --bg-dark: #1d3557;
            --bg-light: #f1faee;
            --text-dark: #1d3557;
            --text-light: #ffffff;
            --border: #a8dadc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #264653 100%);
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: #a8dadc;
            border-radius: 0;
            border-left: 8px solid var(--secondary);
            padding: 30px 40px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 42px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
            color: #000000;
        }

        .header .subtitle {
            font-size: 14px;
            color: #000000;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .station-info {
            margin-top: 15px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            display: inline-block;
            font-weight: 600;
            color: #000000;
        }

        .station-fallback {
            color: var(--warning);
        }

        .refresh-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 40px;
            margin-bottom: 20px;
            border-left: 8px solid var(--secondary);
            font-size: 13px;
        }

        .refresh-bar button {
            padding: 8px 20px;
            background: var(--accent);
            color: var(--text-dark);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .refresh-bar button:hover {
            background: var(--warning);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Alerts Section - Top Priority */
        .alerts-section {
            margin-bottom: 20px;
        }

        .alert {
            background: #ff0000;
            border-left: 8px solid #8b0000;
            padding: 25px 30px;
            margin-bottom: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            animation: pulseAlert 2s ease-in-out infinite;
            color: #000000;
        }

        @keyframes pulseAlert {
            0%, 100% { box-shadow: 0 8px 16px rgba(255, 0, 0, 0.4); }
            50% { box-shadow: 0 8px 24px rgba(255, 0, 0, 0.6); }
        }

        .alert.warning {
            background: #ff0000;
            border-left-color: #8b0000;
        }

        .alert.watch {
            background: #ffff00;
            border-left-color: #cccc00;
            animation: none;
        }

        .alert.advisory {
            background: #dda0dd;
            border-left-color: #9370db;
            animation: none;
        }

        .alert h3 {
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 10px;
            letter-spacing: 1px;
            color: #000000;
        }

        .alert-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .alert-meta span {
            background: rgba(0, 0, 0, 0.15);
            padding: 4px 12px;
            border-radius: 3px;
            color: #000000;
        }

        .alert p {
            line-height: 1.6;
            font-size: 14px;
            color: #000000;
        }

        .no-alerts {
            background: linear-gradient(135deg, var(--success) 0%, #047857 100%);
            color: var(--text-light);
            padding: 30px;
            text-align: center;
            font-family: 'Oswald', sans-serif;
            font-size: 24px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-left: 8px solid #d1fae5;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-left: 8px solid var(--secondary);
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 28px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--accent);
        }

        /* Current Conditions */
        .current-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .metric {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-left: 4px solid var(--accent);
        }

        .metric-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            opacity: 0.7;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .metric-value {
            font-family: 'Oswald', sans-serif;
            font-size: 36px;
            font-weight: 700;
            color: var(--text-light);
            line-height: 1;
        }

        .metric-value.large {
            font-size: 56px;
        }

        .metric-unit {
            font-size: 20px;
            opacity: 0.8;
            margin-left: 4px;
        }

        .wind-alert {
            border-left-color: var(--danger);
            background: rgba(214, 40, 40, 0.2);
            animation: pulseWind 1.5s ease-in-out infinite;
        }

        @keyframes pulseWind {
            0%, 100% { background: rgba(214, 40, 40, 0.2); }
            50% { background: rgba(214, 40, 40, 0.35); }
        }

        /* HRRR Table */
        .hrrr-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .hrrr-table th {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px 10px;
            text-align: center;
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 3px solid var(--accent);
            font-size: 12px;
        }

        .hrrr-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hrrr-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hour-cell {
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
            font-size: 15px;
        }

        .temp-cell {
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }

        .wind-cell {
            font-family: 'Oswald', sans-serif;
            font-weight: 600;
        }

        .wind-high {
            color: var(--danger);
            font-weight: 700;
        }

        .precip-cell {
            font-weight: 600;
        }

        .precip-high {
            color: var(--warning);
            font-weight: 700;
        }

        .lightning-indicator {
            display: inline-block;
            padding: 4px 8px;
            background: var(--danger);
            border-radius: 3px;
            font-weight: 700;
            font-size: 11px;
        }

        /* Forecast Section */
        .forecast-period {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .forecast-period h3 {
            font-family: 'Oswald', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .forecast-temp {
            font-family: 'Oswald', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--text-light);
            margin: 10px 0;
        }

        .forecast-wind {
            color: var(--accent);
            font-weight: 600;
            margin: 8px 0;
            font-size: 15px;
        }

        .forecast-detail {
            line-height: 1.6;
            font-size: 14px;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.9);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
        }

        .error {
            background: rgba(214, 40, 40, 0.2);
            color: var(--text-light);
            padding: 20px;
            border-left: 4px solid var(--danger);
            margin: 10px 0;
            font-weight: 500;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .current-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Boomers Weather Operations</h1>
            <div class="subtitle">Boca Raton, Florida - Live Conditions & Forecast</div>
            <div class="station-info" id="stationInfo">Loading station...</div>
        </div>

        <div class="refresh-bar">
            <div id="refreshTime">Initializing...</div>
            <button onclick="refreshData()">üîÑ Refresh All Data</button>
        </div>

        <!-- ALERTS - TOP PRIORITY -->
        <div class="alerts-section">
            <div class="card full-width">
                <h2>‚ö†Ô∏è Active Alerts & Warnings</h2>
                <div id="alerts" class="loading">Loading alerts...</div>
            </div>
        </div>

        <!-- CURRENT CONDITIONS & RADAR -->
        <div class="grid">
            <div class="card">
                <h2>üìä Current Conditions</h2>
                <div id="currentConditions" class="loading">Loading observations...</div>
            </div>
        </div>

        <!-- HRRR FORECAST -->
        <div class="card full-width">
            <h2>üìà HRRR 12-Hour Forecast</h2>
            <div id="hrrr" class="loading">Loading HRRR data...</div>
        </div>

        <!-- NWS 5-DAY FORECAST -->
        <div class="card full-width">
            <h2>üìÖ NWS 5-Day Forecast</h2>
            <div id="forecast" class="loading">Loading forecast...</div>
        </div>
    </div>

    <script>
        // Station fallback order
        const STATIONS = ['KBCT', 'KPMP', 'KFXE', 'KPBI', 'KFLL'];
        const PARK_LAT = 26.3785;
        const PARK_LON = -80.1077;
        let currentStation = null;

        async function fetchWithFallback() {
            for (let station of STATIONS) {
                try {
                    const url = `https://api.weather.gov/stations/${station}/observations/latest`;
                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        currentStation = station;
                        updateStationInfo(station, station !== STATIONS[0]);
                        return data.properties;
                    }
                } catch (error) {
                    console.log(`Station ${station} unavailable, trying next...`);
                }
            }
            throw new Error('All stations unavailable');
        }

        function updateStationInfo(station, isFallback) {
            const stationInfo = document.getElementById('stationInfo');
            if (isFallback) {
                stationInfo.innerHTML = `<span class="station-fallback">‚ö†Ô∏è Using Backup Station: ${station}</span>`;
            } else {
                stationInfo.innerHTML = `‚úì Primary Station: ${station}`;
            }
        }

        async function fetchWeatherData() {
            try {
                // Fetch observations with fallback
                const obs = await fetchWithFallback();
                displayCurrentConditions(obs);

                // Fetch alerts
                const alertsUrl = `https://api.weather.gov/alerts/active?point=${PARK_LAT},${PARK_LON}`;
                const alertsResponse = await fetch(alertsUrl);
                const alertsData = await alertsResponse.json();
                displayAlerts(alertsData.features);

                // Fetch hourly forecast for HRRR simulation
                const pointsUrl = `https://api.weather.gov/points/${PARK_LAT},${PARK_LON}`;
                const pointsResponse = await fetch(pointsUrl);
                const pointsData = await pointsResponse.json();
                
                const hourlyUrl = pointsData.properties.forecastHourly;
                const hourlyResponse = await fetch(hourlyUrl);
                const hourlyData = await hourlyResponse.json();
                displayHRRR(hourlyData.properties.periods);

                // Fetch 5-day forecast
                const forecastUrl = pointsData.properties.forecast;
                const forecastResponse = await fetch(forecastUrl);
                const forecastData = await forecastResponse.json();
                displayForecast(forecastData.properties.periods);

                updateRefreshTime();
            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('currentConditions').innerHTML = 
                    '<div class="error">‚ö†Ô∏è ERROR: Unable to load weather data. All stations unavailable.</div>';
                document.getElementById('stationInfo').innerHTML = 
                    '<span class="station-fallback">‚ùå All Stations Offline</span>';
            }
        }

        function displayCurrentConditions(obs) {
            const tempC = obs.temperature.value;
            const tempF = tempC !== null ? (tempC * 9/5 + 32).toFixed(1) : 'N/A';
            const dewpointC = obs.dewpoint.value;
            const dewpointF = dewpointC !== null ? (dewpointC * 9/5 + 32).toFixed(1) : 'N/A';
            const windSpeed = obs.windSpeed.value !== null ? 
                (obs.windSpeed.value * 0.621371).toFixed(0) : '0';
            const windGust = obs.windGust.value !== null ? 
                (obs.windGust.value * 0.621371).toFixed(0) : null;
            const windDir = obs.windDirection.value || 0;

            // Check for high wind alert
            const maxWind = Math.max(parseInt(windSpeed), parseInt(windGust || 0));
            const windAlertClass = maxWind >= 30 ? 'wind-alert' : '';

            const html = `
                <div class="current-grid">
                    <div class="metric">
                        <div class="metric-label">Conditions</div>
                        <div class="metric-value" style="font-size: 20px;">
                            ${obs.textDescription || 'Unknown'}
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Temperature</div>
                        <div class="metric-value large">
                            ${tempF}<span class="metric-unit">¬∞F</span>
                        </div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Dew Point</div>
                        <div class="metric-value">
                            ${dewpointF}<span class="metric-unit">¬∞F</span>
                        </div>
                    </div>
                    <div class="metric ${windAlertClass}">
                        <div class="metric-label">Wind ${maxWind >= 30 ? '‚ö†Ô∏è HIGH WIND' : ''}</div>
                        <div class="metric-value">
                            ${windSpeed}<span class="metric-unit">mph</span>
                        </div>
                        <div style="margin-top: 8px; font-size: 14px; opacity: 0.9;">
                            ${windDir}¬∞ ${windGust ? `| Gusts ${windGust} mph` : ''}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('currentConditions').innerHTML = html;
        }

        function displayAlerts(alerts) {
            if (!alerts || alerts.length === 0) {
                document.getElementById('alerts').innerHTML = 
                    '<div class="no-alerts">‚úì No Active Alerts</div>';
                return;
            }

            const html = alerts.map(alert => {
                const props = alert.properties;
                let alertClass = 'alert';
                
                // Determine alert type by event name
                const eventLower = props.event.toLowerCase();
                if (eventLower.includes('warning')) {
                    alertClass = 'alert warning';
                } else if (eventLower.includes('watch')) {
                    alertClass = 'alert watch';
                } else if (eventLower.includes('advisory')) {
                    alertClass = 'alert advisory';
                }

                return `
                    <div class="${alertClass}">
                        <h3>${props.event}</h3>
                        <div class="alert-meta">
                            <span>SEVERITY: ${props.severity}</span>
                            <span>URGENCY: ${props.urgency}</span>
                            <span>CERTAINTY: ${props.certainty}</span>
                        </div>
                        <p><strong>${props.headline || ''}</strong></p>
                        <p style="margin-top: 10px;">${props.description ? 
                            props.description.substring(0, 300) + '...' : ''}</p>
                    </div>
                `;
            }).join('');

            document.getElementById('alerts').innerHTML = html;
        }

        function displayHRRR(hourlyPeriods) {
            const next12Hours = hourlyPeriods.slice(0, 12);
            
            let tableHTML = `
                <table class="hrrr-table">
                    <thead>
                        <tr>
                            <th>Hour</th>
                            <th>Rain</th>
                            <th>Lightning</th>
                            <th>Temp</th>
                            <th>Wind</th>
                            <th>Gusts</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            next12Hours.forEach(period => {
                const time = new Date(period.startTime);
                const hour = time.getHours();
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour % 12 || 12;
                
                const pop = period.probabilityOfPrecipitation.value || 0;
                const precipClass = pop >= 40 ? 'precip-high' : '';
                
                // Parse wind speed and gusts
                const windMatch = period.windSpeed.match(/(\d+)(?:\s+to\s+(\d+))?/);
                const windSpeed = windMatch ? windMatch[1] : '0';
                const windGust = windMatch && windMatch[2] ? windMatch[2] : windSpeed;
                
                const windClass = (parseInt(windGust) >= 30) ? 'wind-high' : '';
                
                // Simple lightning risk based on thunderstorm keywords and high PoP
                const hasThunderstorm = period.shortForecast.toLowerCase().includes('thunder') || 
                                       period.shortForecast.toLowerCase().includes('tstorm') ||
                                       period.shortForecast.toLowerCase().includes('t-storm');
                const lightningRisk = (hasThunderstorm || pop >= 60) ? 
                    '<span class="lightning-indicator">‚ö° RISK</span>' : '-';

                tableHTML += `
                    <tr>
                        <td class="hour-cell">${displayHour} ${ampm}</td>
                        <td class="precip-cell ${precipClass}">${pop}%</td>
                        <td>${lightningRisk}</td>
                        <td class="temp-cell">${period.temperature}¬∞F</td>
                        <td class="wind-cell ${windClass}">${windSpeed} mph</td>
                        <td class="wind-cell ${windClass}">${windGust} mph</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById('hrrr').innerHTML = tableHTML;
        }

        function displayForecast(periods) {
            // Get the next 10 periods (roughly 5 days - day and night)
            const forecastPeriods = periods.slice(0, 10);
            
            const html = forecastPeriods.map(period => `
                <div class="forecast-period">
                    <h3>${period.name}</h3>
                    <div class="forecast-temp">${period.temperature}¬∞${period.temperatureUnit}</div>
                    <div class="forecast-wind">${period.windSpeed} ${period.windDirection}</div>
                    <div class="forecast-detail"><strong>${period.shortForecast}</strong></div>
                    <div class="forecast-detail">${period.detailedForecast}</div>
                </div>
            `).join('');
            
            document.getElementById('forecast').innerHTML = html;
        }

        function updateRefreshTime() {
            const now = new Date();
            document.getElementById('refreshTime').textContent = 
                `Last Updated: ${now.toLocaleTimeString()} | Auto-refresh: 5 min`;
        }

        function refreshData() {
            document.getElementById('currentConditions').innerHTML = '<div class="loading">Refreshing...</div>';
            document.getElementById('alerts').innerHTML = '<div class="loading">Refreshing...</div>';
            document.getElementById('hrrr').innerHTML = '<div class="loading">Refreshing...</div>';
            document.getElementById('forecast').innerHTML = '<div class="loading">Refreshing...</div>';
            fetchWeatherData();
        }

        // Initial load
        fetchWeatherData();

        // Auto-refresh every 5 minutes
        setInterval(fetchWeatherData, 300000);
    </script>
</body>
</html>
